<?xml version="1.0"?>
<!--
	Copyright (c) 2004 on behalf of the EU EGEE Project: 
	The European Organization for Nuclear Research (CERN), 
	Istituto Nazionale di Fisica Nucleare (INFN), Italy
	Datamat Spa, Italy
	Centre National de la Recherche Scientifique (CNRS), France
	CS Systeme d'Information (CSSI), France
	Royal Institute of Technology, Center for Parallel Computers (KTH-PDC), Sweden
	Universiteit van Amsterdam (UvA), Netherlands
	University of Helsinki (UH.HIP), Finland
	University of Bergen (UiB), Norway
	Council for the Central Laboratory of the Research Councils (CCLRC), United Kingdom

	gLite Middleware Logging and Bookkeping Configuration Specification File
	
	Authors: Alberto Di Meglio <alberto.di.meglio@cern.ch>	
	         Joachim Flammer <Joachim.Flammer@cern.ch>	
	         Ales Krenek <ljocha@ics.muni.cz>
	Version info: $Id$
	Release: $Name$

	Revision history:
	$Log$
	Revision 1.9  2004/11/29 15:16:26  zsalvet
	Add ws-interface to checkout/build machinery.
	
	Revision 1.8  2004/10/18 22:55:14  dimeglio
	Added oscheck to various targets
	
	Revision 1.7  2004/10/15 12:30:01  akrenek
	build with lb.sever-bones
	
	Revision 1.6  2004/08/27 10:03:41  zurek
	typo problem
	
	Revision 1.5  2004/08/27 09:13:11  zurek
	changing thee order for build
	
	Revision 1.4  2004/07/29 10:47:46  dimeglio
	Added server and logger
	
	Revision 1.3  2004/07/16 16:25:43  flammer
	Added tags for automated adding of components.
	
	Revision 1.2  2004/06/23 00:22:11  dimeglio
	Added client and client-interface components
	
	Revision 1.1  2004/06/18 23:05:53  dimeglio
	Added/upgraded default build scripts
	
-->


<project name="GLite Middleware Logging and Bookkeping CSF" default="all">

	<!-- ===============================================
		  Determine workspace directory 
		 =============================================== -->

	<!-- Relative workspace root directory -->
	<property name="workspace.dir" value="../.." />
	
	<!-- ===============================================
		 Load properties
		 =============================================== -->

	<!-- load baseline and user properties -->
	<import file="${workspace.dir}/org.glite/project/baseline.properties.xml" />

	<!-- define build properties file location since we are already in project dir -->
	<property name="subsystem.build.properties.file" value="./build.properties" />

	<!-- Load subsystem-specific property file -->
	<property file="./properties.xml"/>

	<!-- load global properties -->
	<import file="${global.properties.file}" />

	<!-- ===============================================
		 Load dependencies 
		 =============================================== -->

	<!-- Load user dependencies file -->
	<property file="${user.dependencies.file}" />
		
	<!-- Load subsystem dependencies file -->
	<property file="./dependencies.properties" />

	<!-- Load global dependencies file -->
	<property file="${global.dependencies.file}" />

	<!-- ===============================================
		 Load targets
		 =============================================== -->
	<import file="${global.targets-envchecks.file}" />
	<import file="${global.targets-external-dependencies.file}" />	

	<!-- ===============================================
		 Evaluate CVS tags
		 =============================================== -->

    	<target name="evaluate.cvs.tags" description="Figure out if we need tagged CVS checkout">
		<condition property="glite.head">
			<and>
				<equals arg1="${org.glite.version}" arg2="HEAD" />
				<or>
					<istrue value="${update}" />
					<not>
						<available file="${global.dependencies.file}" type="file" />
					</not>
				</or>
			</and>
		</condition>
		<condition property="glite.tag">
			<and>
				<not>
					<equals arg1="${org.glite.version}" arg2="HEAD" />
				</not>
				<or>
					<istrue value="${update}" />
					<not>
						<available file="${global.dependencies.file}" type="file" />
					</not>
				</or>
			</and>
		</condition>
		<condition property="glite-lb.head">
			<and>
				<equals arg1="${org.glite.lb.version}" arg2="HEAD" />
				<istrue value="${update}" />
			</and>
		</condition>
		<condition property="glite-lb.tag">
			<and>
				<not>
					<equals arg1="${org.glite.lb.version}" arg2="HEAD" />
				</not>
				<istrue value="${update}" />
			</and>
		</condition>
	
		<!-- condition property tag = do not remove = -->

		<condition property="common.head">
			<equals arg1="${org.glite.lb.common.version}" arg2="HEAD" />
		</condition>

		<condition property="server-bones.head">
			<equals arg1="${org.glite.lb.server-bones.version}" arg2="HEAD" />
		</condition>

		<condition property="client-interface.head">
			<equals arg1="${org.glite.lb.client-interface.version}" arg2="HEAD" />
		</condition>

		<condition property="ws-interface.head">
			<equals arg1="${org.glite.lb.ws-interface.version}" arg2="HEAD" />
		</condition>

		<condition property="client.head">
			<equals arg1="${org.glite.lb.client.version}" arg2="HEAD" />
		</condition>

		<condition property="server.head">
			<equals arg1="${org.glite.lb.server.version}" arg2="HEAD" />
		</condition>

		<condition property="logger.head">
			<equals arg1="${org.glite.lb.logger.version}" arg2="HEAD" />
		</condition>

    	</target>

    	<presetdef name="cvs-co">
		<cvs command="checkout" dest="${workspace.dir}" />
    	</presetdef>

	<!-- =====================================================
		 Self-update if required
		 ===================================================== -->
		
	<!-- Update main GLite module -->
 	<target name="org.glite" depends="evaluate.cvs.tags, get.glite.head, get.glite.tag"/>
	<target name="get.glite.head" if="glite.head">
		<cvs-co package="org.glite" />
	</target>
	<target name="get.glite.tag" if="glite.tag">
		<cvs-co package="org.glite"
			tag="${org.glite.version}" />
	</target>

	<!-- Update the current module -->
 	<target name="org.glite.lb" depends="evaluate.cvs.tags, get.glite-lb.head, get.glite-lb.tag"/>
	<target name="get.glite-lb.head" if="glite-lb.head">
		<cvs-co package="org.glite.lb" />
		<fail>The org.glite and org.glite.lb modules have been updated, please rerun the configuration file</fail>
	</target>
	<target name="get.glite-lb.tag" if="glite-lb.tag">
		<cvs-co package="org.glite.lb"
			tag="${org.glite.lb.version}" />
		<fail>The org.glite and org.glite.lb modules have been updated, please rerun the configuration file</fail>
	</target>

	<!-- *****************************************************-->
	<!-- Development tools                                    -->
	<!-- *****************************************************-->
	
	<!-- All development tools -->
 	<target name="devtools" depends="oscheck,
					evaluate.cvs.tags,
 					 				 junitcheck,
					 				 junit,
 									 chkstyle,
 									 jalopy,
 									 ant-contrib,
 									 cpptasks,
 									 egee-ant-ext"
 			description="Get development tools into repository."/>		

	<!-- =====================================================
		 External libraries
		 ===================================================== -->
	
	<!--  All external libraries -->
 	<target name="external" depends="oscheck, evaluate.cvs.tags, globus"
 			description="Install external packages"/>
 	
	<!-- =====================================================
		 GLite Middleware R-GMA modules
		 ===================================================== -->

	<!-- component targets tag = do not remove = -->
	
	<!-- common -->
 	<target name="common" depends="evaluate.cvs.tags, get.common.head, get.common.tag"/>
	<target name="get.common.head" if="common.head">
		<cvs-co package="org.glite.lb.common" />
	</target>
	<target name="get.common.tag" unless="common.head">
		<cvs-co package="org.glite.lb.common"
			tag="${org.glite.lb.common.version}" />
	</target>

	<!-- server-bones -->
 	<target name="server-bones" depends="evaluate.cvs.tags, get.server-bones.head, get.server-bones.tag"/>
	<target name="get.server-bones.head" if="server-bones.head">
		<cvs-co package="org.glite.lb.server-bones" />
	</target>
	<target name="get.server-bones.tag" unless="server-bones.head">
		<cvs-co package="org.glite.lb.server-bones"
			tag="${org.glite.lb.server-bones.version}" />
	</target>

	<!-- client-interface -->
 	<target name="client-interface" depends="evaluate.cvs.tags, get.client-interface.head, get.client-interface.tag"/>
	<target name="get.client-interface.head" if="client-interface.head">
		<cvs-co package="org.glite.lb.client-interface" />
	</target>
	<target name="get.client-interface.tag" unless="client-interface.head">
		<cvs-co package="org.glite.lb.client-interface"
			tag="${org.glite.lb.client-interface.version}" />
	</target>

	<!-- WS interface -->
 	<target name="ws-interface" depends="evaluate.cvs.tags, get.ws-interface.head, get.ws-interface.tag"/>
	<target name="get.ws-interface.head" if="ws-interface.head">
		<cvs-co package="org.glite.lb.ws-interface" />
	</target>
	<target name="get.ws-interface.tag" unless="ws-interface.head">
		<cvs-co package="org.glite.lb.ws-interface"
			tag="${org.glite.lb.ws-interface.version}" />
	</target>

	<!-- client -->
 	<target name="client" depends="evaluate.cvs.tags, get.client.head, get.client.tag"/>
	<target name="get.client.head" if="client.head">
		<cvs-co package="org.glite.lb.client" />
	</target>
	<target name="get.client.tag" unless="client.head">
		<cvs-co package="org.glite.lb.client"
			tag="${org.glite.lb.client.version}" />
	</target>

	<!-- server -->
 	<target name="server" depends="evaluate.cvs.tags, get.server.head, get.server.tag"/>
	<target name="get.server.head" if="server.head">
		<cvs-co package="org.glite.lb.server" />
	</target>
	<target name="get.server.tag" unless="server.head">
		<cvs-co package="org.glite.lb.server"
			tag="${org.glite.lb.server.version}" />
	</target>

	<!-- logger -->
 	<target name="logger" depends="evaluate.cvs.tags, get.logger.head, get.logger.tag"/>
	<target name="get.logger.head" if="logger.head">
		<cvs-co package="org.glite.lb.logger" />
	</target>
	<target name="get.logger.tag" unless="logger.head">
		<cvs-co package="org.glite.lb.logger"
			tag="${org.glite.lb.logger.version}" />
	</target>

	<!-- All project modules -->
 	<target name="project" depends="client-interface,
						ws-interface,
 						common,
 						server-bones,
 						client,
 						server,
 						logger"/>


	<!-- ====================================================
		 Checkout all
		 ==================================================== -->
	
	<!-- All libraries -->
 	<target name="all" depends="oscheck,evaluate.cvs.tags, defaultenvchecks, org.glite, org.glite.lb, devtools, external, project" />		

	<!-- ====================================================
		 Print dependecies to console
		 ==================================================== -->
	
 	<target name="dependencies">
 		<concat>
 			<fileset dir="." includes="dependencies.properties" />
 		</concat>
 	</target>		

</project>
